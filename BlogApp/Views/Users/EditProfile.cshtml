@model ProfileEditViewModel

@{
    ViewData["Title"] = "Edit Profile";
}

<style>
    .edit-profile-card {
        max-width: 600px;
        margin: 2rem auto;
        margin-top: 40px !important;
        padding: 2.5rem;
        background: var(--card-background);
        border-radius: 1rem;
        box-shadow: 0 2px 0 var(--primary-color);
    }

    .btn-primary {
        background: var(--primary-color);
        border: none !important;
    }

    .btn-primary:hover {
        background: var(--secondary-color);

    }

    h2 {
        font-weight: 800;
        font-size: 40px;
        color: var(--primary-color);
        text-shadow: 0 1px 0 var(--primary-color);
        font-family: Arial, Helvetica, sans-serif;
    }

    label,
    h5 {
        font-weight: 700 !important;
        color: var(--primary-color);
    }

    .profile-image-preview {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--border-color);
    }

    .input-group-password {
        position: relative;
    }

    .input-group-password .toggle-password {
        position: absolute;
        right: 15px;
        top: 50px;
        font-weight: 700;
        transform: translateY(-50%);
        cursor: pointer;
    }

    .form-control {
        background-color: var(--card-background);
        border-color: var(--border-color);
        color: var(--text-color);
    }

    .form-control:focus {
        background-color: var(--card-background);
        border-color: var(--primary-color);
        color: var(--text-color);
        box-shadow: 0 0 0 0.25rem rgba(var(--primary-color-rgb), 0.25);
    }
</style>

<div class="edit-profile-card">
    <h2 class="text-center mb-4">Edit Your Profile</h2>
    <form asp-action="EditProfile" method="post" enctype="multipart/form-data">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

        <div class="text-center mb-4">
            <img id="imagePreview" src="/img/@(Model.Image ?? "default-avatar.jpg")" alt="Profile Preview"
                class="profile-image-preview" />
        </div>

        <div class="mb-3">
            <label asp-for="ImageFile" class="form-label"></label>
            <input asp-for="ImageFile" class="form-control"
                onchange="document.getElementById('imagePreview').src = window.URL.createObjectURL(this.files[0])">
            <span asp-validation-for="ImageFile" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Name" class="form-label"></label>
            <input asp-for="Name" class="form-control">
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="UserName" class="form-label"></label>
            <input asp-for="UserName" class="form-control">
            <span asp-validation-for="UserName" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Email" class="form-label"></label>
            <input asp-for="Email" class="form-control">
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>

        <hr class="my-4">
        <h5 class="mb-3">Change Password (optional)</h5>

        <div class="mb-3 input-group-password">
            <label asp-for="CurrentPassword" class="form-label"></label>
            <input asp-for="CurrentPassword" class="form-control" id="currentPasswordInput">
            <span class="toggle-password" onclick="togglePasswordVisibility('currentPasswordInput', this)"><i
                    class="bi bi-eye-slash"></i></span>
            <span asp-validation-for="CurrentPassword" class="text-danger"></span>
        </div>

        <div class="mb-3 input-group-password">
            <label asp-for="NewPassword" class="form-label"></label>
            <input asp-for="NewPassword" class="form-control" id="newPasswordInput">
            <span class="toggle-password" onclick="togglePasswordVisibility('newPasswordInput', this)"><i
                    class="bi bi-eye-slash"></i></span>
            <span asp-validation-for="NewPassword" class="text-danger"></span>
        </div>

        <div class="mb-3 input-group-password">
            <label asp-for="ConfirmNewPassword" class="form-label"></label>
            <input asp-for="ConfirmNewPassword" class="form-control" id="confirmNewPasswordInput">
            <span class="toggle-password" onclick="togglePasswordVisibility('confirmNewPasswordInput', this)"><i
                    class="bi bi-eye-slash"></i></span>
            <span asp-validation-for="ConfirmNewPassword" class="text-danger"></span>
        </div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">Update Profile</button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        function togglePasswordVisibility(id, iconElement) {
            const input = document.getElementById(id);
            const icon = iconElement.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            } else {
                input.type = 'password';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            }
        }
    </script>
}